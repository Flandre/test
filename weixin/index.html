<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Title</title>
</head>
<body>
<img src="test.jpg" alt="test">
<img src="test2.png" alt="test">
<p class="info"></p>
</body>
<script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
  var info = $('.info')
  info.append('<p>wx config</p>')
  wx.config({
    debug: false,
    appId: 'wxf8b4f85f3a794e77',
    timestamp: 1495706467,
    nonceStr: 'o2nvWhy6qjOa6K1g',
    signature: '331230419bdbc967255399ecece6178e0223e55f',
    jsApiList: [
      'checkJsApi',
      'onMenuShareTimeline',
      'onMenuShareAppMessage',
      'onMenuShareQQ',
      'onMenuShareWeibo',
      'onMenuShareQZone',
      'hideMenuItems',
      'showMenuItems',
      'hideAllNonBaseMenuItem',
      'showAllNonBaseMenuItem',
      'translateVoice',
      'startRecord',
      'stopRecord',
      'onVoiceRecordEnd',
      'playVoice',
      'onVoicePlayEnd',
      'pauseVoice',
      'stopVoice',
      'uploadVoice',
      'downloadVoice',
      'chooseImage',
      'previewImage',
      'uploadImage',
      'downloadImage',
      'getNetworkType',
      'openLocation',
      'getLocation',
      'hideOptionMenu',
      'showOptionMenu',
      'closeWindow',
      'scanQRCode',
      'chooseWXPay',
      'openProductSpecificView',
      'addCard',
      'chooseCard',
      'openCard'
    ]
  });
  info.append('<p>wx config end</p>')
  info.append('<p>wx ready</p>')
  info.append('<p>wx ready end</p>')

  info.append('2')
  $('img').each(function(){
    var img = $(this), url = location.href + img.attr('src');
    img.on('click', function(e){
      info.append('<p>'+url+'</p>')
      e.preventDefault();
      /* 判断微信环境，微信使用原生图片浏览，普通浏览器直接打开图片 */
      if(window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i) == 'micromessenger'){
        info.append('<p>preview start</p>')
        wx.previewImage({
          current: url, // 当前显示图片的http链接
          urls: [url] // 需要预览的图片http链接列表
        });
      } else {
        location.href = src;
      }
    })
  })
</script>
</html>